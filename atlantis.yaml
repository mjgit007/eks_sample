version: 3
automerge: false
delete_source_branch_on_merge: false
parallel_plan: false
parallel_apply: false
projects:
- name: infradev
  dir: .
  workspace: dev
  #terraform_version: v0.11.0
  delete_source_branch_on_merge: false
  autoplan:
    when_modified: ["*.tf", "dev.tfvars"]
    enabled: true
  apply_requirements: []
  workflow: dev
- name: infraprod
  dir: .
  workspace: prod
  # terraform_version: v0.11.0
  delete_source_branch_on_merge: false
  autoplan:
    when_modified: ["*.tf", "prod.tfvars"]
    enabled: true
  apply_requirements: [approved]
  workflow: prod
workflows:
  dev:
    plan:
      steps:
      - run: echo " Please verify the terraform plan output of Dev instance . If output looks fine , then apply the changes and Merge the codebase"
      - init
      - plan:
          extra_args: ["-var-file", "dev.tfvars"]
    apply:
      steps:
      - run: echo "Applying the infrastructure changes"
      - apply
  prod:
    plan:
      steps:
      - run: echo " Please verify the terraform plan output of Prod instance . If output looks fine , then apply the changes and Merge the codebase"
      - init
      - plan:
          extra_args: ["-var-file", "prod.tfvars"]
    apply:
      steps:
      - run: echo "Applying the infrastructure changes"
      - apply
      
